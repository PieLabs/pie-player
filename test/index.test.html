<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script src="../node_modules/web-component-tester/browser.js"></script>
  <script src="bundle.js"></script>
</head>
<body>
  <pie-player>
    <my-comp data-id="1"></my-comp>
  </pie-player>
  <script>

    describe('<pie-player>', function() {
      var el, mockController;
      beforeEach(function(done){

        this.timeout(30000);

        mockController = {
          model: sinon.spy(function(){
            console.log('arguments: ' + JSON.stringify(arguments));
            return Promise.resolve([{id: '1', value: 'model-result'}]);
          })
       };

        el = document.querySelector('pie-player');
        
        el.addEventListener('pie', function(event){
          console.log('model has been updated');
          if(event.detail.type === 'modelUpdated'){
            done();
          }
        });

        el.env = {mode: 'gather'};
        el.session = [];
        el.controller = mockController;
      });

      it('isnt null', function() {
        expect(el).not.to.be.null;
      });

      it('calls controller.model', function(){
        sinon.assert.calledWith(mockController.model, ['1'], [{id: '1'}], {mode: 'gather'});
      });
    });
  </script>
</body>
</html>